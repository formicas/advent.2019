package main

import (
	"fmt"
	"math"
	"strconv"

	"advent.2019/intcode"
	"advent.2019/sif"
)

func main() {
	// day1()
	// day2()
	// day3()
	// day4()
	// day5()
	// day6()
	// day7()
	// day8()
	day9()
}

func day9() {
	program := []int{1102, 34463338, 34463338, 63, 1007, 63, 34463338, 63, 1005, 63, 53, 1102, 1, 3, 1000, 109, 988, 209, 12, 9, 1000, 209, 6, 209, 3, 203, 0, 1008, 1000, 1, 63, 1005, 63, 65, 1008, 1000, 2, 63, 1005, 63, 904, 1008, 1000, 0, 63, 1005, 63, 58, 4, 25, 104, 0, 99, 4, 0, 104, 0, 99, 4, 17, 104, 0, 99, 0, 0, 1101, 0, 0, 1020, 1102, 1, 800, 1023, 1101, 0, 388, 1025, 1101, 0, 31, 1012, 1102, 1, 1, 1021, 1101, 22, 0, 1014, 1101, 0, 30, 1002, 1101, 0, 716, 1027, 1102, 32, 1, 1009, 1101, 0, 38, 1017, 1102, 20, 1, 1015, 1101, 33, 0, 1016, 1101, 0, 35, 1007, 1101, 0, 25, 1005, 1102, 28, 1, 1011, 1102, 1, 36, 1008, 1101, 0, 39, 1001, 1102, 1, 21, 1006, 1101, 397, 0, 1024, 1102, 1, 807, 1022, 1101, 0, 348, 1029, 1101, 0, 23, 1003, 1101, 29, 0, 1004, 1102, 1, 26, 1013, 1102, 34, 1, 1018, 1102, 1, 37, 1010, 1101, 0, 27, 1019, 1102, 24, 1, 1000, 1101, 353, 0, 1028, 1101, 0, 723, 1026, 109, 14, 2101, 0, -9, 63, 1008, 63, 27, 63, 1005, 63, 205, 1001, 64, 1, 64, 1106, 0, 207, 4, 187, 1002, 64, 2, 64, 109, -17, 2108, 24, 6, 63, 1005, 63, 223, 1105, 1, 229, 4, 213, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, 7, 2101, 0, 2, 63, 1008, 63, 21, 63, 1005, 63, 255, 4, 235, 1001, 64, 1, 64, 1106, 0, 255, 1002, 64, 2, 64, 109, -7, 2108, 29, 7, 63, 1005, 63, 273, 4, 261, 1106, 0, 277, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, 10, 1208, -5, 31, 63, 1005, 63, 293, 1105, 1, 299, 4, 283, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, 2, 1207, -1, 35, 63, 1005, 63, 315, 1106, 0, 321, 4, 305, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, 8, 1205, 3, 333, 1106, 0, 339, 4, 327, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, 11, 2106, 0, 0, 4, 345, 1106, 0, 357, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, -15, 21108, 40, 40, 6, 1005, 1019, 379, 4, 363, 1001, 64, 1, 64, 1106, 0, 379, 1002, 64, 2, 64, 109, 16, 2105, 1, -5, 4, 385, 1001, 64, 1, 64, 1105, 1, 397, 1002, 64, 2, 64, 109, -25, 2102, 1, -1, 63, 1008, 63, 26, 63, 1005, 63, 421, 1001, 64, 1, 64, 1106, 0, 423, 4, 403, 1002, 64, 2, 64, 109, -8, 1202, 9, 1, 63, 1008, 63, 25, 63, 1005, 63, 445, 4, 429, 1105, 1, 449, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, 5, 1207, 0, 40, 63, 1005, 63, 467, 4, 455, 1106, 0, 471, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, -6, 2107, 24, 8, 63, 1005, 63, 487, 1105, 1, 493, 4, 477, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, 15, 21107, 41, 40, 1, 1005, 1011, 509, 1106, 0, 515, 4, 499, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, 12, 1205, -1, 529, 4, 521, 1105, 1, 533, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, -20, 2102, 1, 2, 63, 1008, 63, 29, 63, 1005, 63, 555, 4, 539, 1105, 1, 559, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, 15, 1201, -9, 0, 63, 1008, 63, 38, 63, 1005, 63, 579, 1105, 1, 585, 4, 565, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, -2, 21102, 42, 1, -3, 1008, 1012, 44, 63, 1005, 63, 609, 1001, 64, 1, 64, 1106, 0, 611, 4, 591, 1002, 64, 2, 64, 109, -21, 2107, 29, 8, 63, 1005, 63, 629, 4, 617, 1106, 0, 633, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, 15, 1202, 0, 1, 63, 1008, 63, 30, 63, 1005, 63, 657, 1001, 64, 1, 64, 1106, 0, 659, 4, 639, 1002, 64, 2, 64, 109, 15, 21102, 43, 1, -8, 1008, 1016, 43, 63, 1005, 63, 681, 4, 665, 1105, 1, 685, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, -10, 21107, 44, 45, -4, 1005, 1010, 707, 4, 691, 1001, 64, 1, 64, 1106, 0, 707, 1002, 64, 2, 64, 109, 11, 2106, 0, 2, 1001, 64, 1, 64, 1106, 0, 725, 4, 713, 1002, 64, 2, 64, 109, -16, 21101, 45, 0, 8, 1008, 1017, 43, 63, 1005, 63, 749, 1001, 64, 1, 64, 1105, 1, 751, 4, 731, 1002, 64, 2, 64, 109, -3, 1208, 2, 36, 63, 1005, 63, 773, 4, 757, 1001, 64, 1, 64, 1106, 0, 773, 1002, 64, 2, 64, 109, 18, 1206, -4, 787, 4, 779, 1105, 1, 791, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, -8, 2105, 1, 7, 1001, 64, 1, 64, 1106, 0, 809, 4, 797, 1002, 64, 2, 64, 109, -2, 21108, 46, 44, 2, 1005, 1016, 825, 1105, 1, 831, 4, 815, 1001, 64, 1, 64, 1002, 64, 2, 64, 109, 7, 21101, 47, 0, -8, 1008, 1013, 47, 63, 1005, 63, 857, 4, 837, 1001, 64, 1, 64, 1105, 1, 857, 1002, 64, 2, 64, 109, -17, 1201, -4, 0, 63, 1008, 63, 24, 63, 1005, 63, 883, 4, 863, 1001, 64, 1, 64, 1105, 1, 883, 1002, 64, 2, 64, 109, 10, 1206, 7, 895, 1106, 0, 901, 4, 889, 1001, 64, 1, 64, 4, 64, 99, 21102, 1, 27, 1, 21102, 1, 915, 0, 1105, 1, 922, 21201, 1, 24405, 1, 204, 1, 99, 109, 3, 1207, -2, 3, 63, 1005, 63, 964, 21201, -2, -1, 1, 21101, 942, 0, 0, 1106, 0, 922, 22102, 1, 1, -1, 21201, -2, -3, 1, 21101, 0, 957, 0, 1106, 0, 922, 22201, 1, -1, -2, 1106, 0, 968, 21201, -2, 0, -2, 109, -3, 2106, 0, 0}

	input := make(chan int, 2)
	output := make(chan int, 100)
	halted := make(chan int)
	p := intcode.Program{Code: program, Input: input, Output: output, Halted: halted}
	// input <- 1
	// go p.Run()
	// <-halted
	// //this is ok because I'm the only reader
	// for len(output) > 0 {
	// 	fmt.Println(<-output)
	// }

	input <- 2
	go p.Run()
	<-halted
	//this is ok because I'm the only reader
	for len(output) > 0 {
		fmt.Println(<-output)
	}
}

func day8() {
	img := sif.Image{Width: 25, Height: 6, Code: []rune("222222222222212222221221222222220221222212022222001222222212121222222222222122222222210022222222022012222120222222222220122222222222222222222222222022222222222222222222221220222202222222222202222222002222222202122222222222222222222222220022222222122002222020222222022220022222222222222222222222222022222222222222212222220221222202222220222202022222121222222202122222222222222022222222220212222222022212222221222222022220122222222222222222222222212222222222222222202222221220222212220222222202222222222222222202020222222222222122222222202122222222022002222220222222022220122222222222222222222222222122222222222222212222220222222212221220222202122222202222222222120222222222222222222222211012222222022022222220222222122222122222222222222222222222212122222222222222202222221222222212221222222202122222222222222212222222222222222022222222210222222222222022222021222222122221122222222222222222222222202222222222222222202222220222222212220222222002222222210222222212020222222222222122222222210222222222222022222022222222022222022222222222222222222222222122222222222222202222222220222202222222222122022222121222222202020222222222222202222222222022222222022102222022222222122221222222222222222222222222202022222222222222202222220220222222221220222102022222201222222212121222222222222212222222200102222222222112222222222222222221222222222222222222222222200222222222222222202222220220222202220220222112222222120222222202122222222222222112222122210022222222222222222221222222220222122222222222222222222222201122222222222222212222220220022222221222202222222222210222222202022222222222222122222222210002222222222102222121222222121222022222222222222222222222210022222222222222202222222222022222221221202212222222022222222202220222222222222012222122201022222222222012222221222222221220122222222222222222222222221022222222222222212222220221022212220221212002222222220222222212221222222222222022222022211022222222122022222120222222221220122222222222222222222222222122222222222222210222222222222202221222202112122222120222222212120222222222222022222022221222222222222222222220221222121222022222222222222222222222201122222222222222202222222220222202221221202102022222121222222212221222222222222112222122202122222222022122222221222222121221022222222222222222222222210222222222222222221222220220222202222220202122222222000222222212020222222222222102222022200102222222122002222021221222121220022222222222222222222222200222222222222222201222221221122212222220222222122122210222222202120222222222222102222022211122222222122112222121221222122221222222222222222222202222200222222222222222201222221221222212221222212112022122101222222212222222222222222102222222220222222222122122222122220222022222022222222222222222222221211222222222222222221222220222022222220221201122022022201222222212121222222222222012222122212022222222222102222021221222220221222222222222222222222221220222222222222222201222220220022202220221210112122022002222222212221222222222222022222222200122222222022012222120222222222220022222222222222222222222201122222222222222201222220221222212220222222212222122021222222212221222222222222222222222221022222222022212222221222222222220122222222222222222202220212222222222222222220222220220122222221222220222022222202222222222122222222222222202222222210002222222022222222122220222022222122222222222222222212221200222222222222222220222221221022222221220222102122222012222222212220222222222222012222122222022222222222102222121221222220221022222222222212222212221222122222222222222220222221221222202200220222102222122120222222222022222222222222102222022202022222222022002222221220222220221122222222222222222202220221022222222222222211222221222122202222220202022122122100222222212222222222222222112202122211202222222222222220121220222021222022222222222212222212222222022222222222222221222222221022212201220220112222022102222222202122222222222222002212122212222222222020212221022220222121221022222222222212222212222212122222202222222221222221220222222220221200012122022001222222202020222222222222102202222210222222222022002220120222222022222122222022222222222222220222122222222222222201222220220022222201220220022122122210222222202021222222222222222202222210022222222121112222021222222122222022222022222202222202222210222222222122222211222221220022212200221201202122022112222222222222222222222222212222222220122222222021112221122222222022221222222220212202222202221222222222222022222211222220221122212200220222012122022211222222212221222222222222102202022210012222222121022221121220222220221022222222222222222222222220122222212122222212222221222212202210221200212122022002222222212220222222222222102222122201112222222120122221121221222211220022222222212212222222221222122222212122222200222220221002212221221210112222022011222222202112222222222222212202222221122222222022122220222221022102221122222221222212222202222202222222212222222220222220221212202220222202002222122201222222212011222222222222022222122201022222222120122220021221222000220022222122212212222212220202122222212122022212222121220022222222221202212122222110222222202021222222222222202202222212122222222220202220222221222021220022022221202222222222220212222222212222122201222021221102202220220201112022222110222222212202222222222222112212022220022222222021212220021222222011221222122020202222222212222202122222212212222211222021220202202212220220202122022122222222222221222220222222102222122212012222222222222220121222022110220022022222222202222202221211022222202222022220222220222012202211220220102222222021222222022002222222222222122202022212112222222120112220120222222112221022122220202212222212220200122222222102022212222122220102202212220201002222122002222222022021222221222222212202022212122222222221002220221222222010222022022120202222222202221220122222202012122220222020222102212211220212002022222110222222122201222221222222122212022220022222222021202221120222022121221122122222210212222122220220022222222122022222222121120022222211222220222022122012222222012211222222222222102202122221212222222021012220121222222022220222222222202202222202222201222222212202022221222220122202202202221221122222022012222222202211222222222222202212022210212222222022012222220222022011022222122021210202222112220221222222222222122201222121221022202202222211222022222022222222022212222221222222102212222220202222222022222221122220022001001122222122212212202122220201122222202002222202222022022212202221222220112022222001222222012020222221222222102222022200012222222221212222022220022121110022122221221202202112222220202222202022122222222222120102202202222222212222022001222222022020222220222122112212022210212222222121202221120220121211120022122122220012202202222221112222202212122211222121022222222201220201022122022010222222002000202222022122222212222212222222222121112222121121220122221222222122210022202012222212122222202002022212222121222122202210222222122222122102222222002211202120022022112202222220202222222121002220220121021120200022122220201212222102221221212222222002022212222022222112202111220202212222122200222222122001222122222122122212122201212222222121112220121022022101102122022122212212212112210202222222222122222220222122222202212000222210022222222020222222012222202021022222112202022212012222222120202221021221220100100022222021211012222222211221222222222012122210222120220022222112221212202022122020222022002220202121022122112202222212002222222220112220220020101002110122222020201202222012200210222222222212122211222002220112212120222200022222022011222122212111202022222222012222222212112222222122202221120121000120012022022121202022212102212210002222212112122221222220121012202022221211102222122000222222022200222222022122112212122220222222222121002220222221211221201022022222222202202102220212002222212122122202222101021222212221221201022122122101222222202022222020222222210212222222122222222122022222120221022201011222122022201122222212222221112222202112022221222222120222212202202200012222022202222022222020212022122022101212122212122222222122202222221021102002120222122121221212212102221222002222202212122220222001021022212120212212222022222200220122102022222221222022221202222210022222222121122220022121101112201022022021220002202212202201002222212212022200222211120222212210210201002222022210221022122121222211122122122212022200012222222221002222122022001100222122121020211102202022221212102222222212122212222200021012202222221221122222122201220122002111222111222122111202221211002222222220022221221020120002111022221221220012202122210200002222202002222220222100222202202212221211002220222200221122222221212112022222011202021200222222222222112220022222121002202222222122210202202002222211112222222012022200222100220012220120221221112022022200222122012111222211122222000202021222022222222021012220021220111221122022022221202102222122212212112222212022122202222011222222210210220210002121122021222122222210212010222022201202121222202222222120102221221121221010112022121122221002212112200200002222202012222221222102222002200112220210012022022000220022202000222102122122121202020201022222222121112220221022202201021222221120201010212002200210212222212202222220212000021102210211212202012021122212221022002001202111222222112212220222222202222221222221220220111011020022220122020112212222202201222222202122022212222122222222211122222201122121122202222222122011202201022222201202221202122212222021222222222021001212002122122022021012212112210202012222212102022211202211221022220122221221022020022012221022002200202202121222010202120220002212222220012222220121201102012222222020110211202012222202012222212112022212202012021102221110212210002222122020221222212101212211021022112212122210112222202121022021021122120022022222122121220110222222202201022222202102022220222221021102201220202221212121022111220222102001212202222222020212122221202212202221102221120121212010221022022120000112210212222210112222202022122221212112121112200000212211112121022220211122212121212111220222021222222221222222202221222220021122212001202022120121222221210121210201122222212222122201212212222002201101211202222021222202210222212022212221221222112212221201102202202121022220120020222020000222120222212101201222212222222222212122222221222122122122222200221200202220122202201022222100202212121022111202121200102212222221122020120222022201201222122220011220222110201220210222222122222221202020120012200121202200002220222122212122002002202200020022202222122201012212212122112022221202212121112122222020121212220021221201002222202122022221222112120012222020211220012020122121222222222121202201220122012202222222002212212122112020022211200020002122220020201120212012210212212222212122222220202222010222201121221222202021220021200122002102212200022122121222220222022212222122102120122120020010000022220020000000220100202201201122222222022202212101210202200021200211002122021101202122222222222221121022222212021201022200202022122222122112220022220022001121220102202200212200101022212222022222222222102012200001200222212122221221210122202121222202020122220212222210002210222220212021020002210102021122012221022200201122201221212222102202020211212221220112211202200211102102020120202122112202222212122122001222221220012220202221022020021112200202021222210121022022210120200212202122212212122222212000000212221020222202112220222220212122122001212022221222002212120221202211202020102120221020021122220022200120020102202000211221101221012222222202222100101022200012210220022121221121201122022111222102122222000222120211012200222120102102222111220202202022201020101202222121220222001222002202222210202012021212022221221221112210021021200222012012202102020122022222122211102221202121112012221102221112222222201020120221211201200212221021122002111221212112102102212111220202112201221021212022212200212121021222222202122211212212202122102111120102221100000122120220222220212100210200120222202002020202222222212202020100220202102202021120220222212101212200020022100202022201212201212221002210122021200100011102102222100000211122210220100020102112002201222022212122011100201210012211220010201122112000202000022222101212121220112211202121222110022010112001210022020122021101221120210210010222222202112220222021222112212120221200012011021111210020002201212200121122001212220210212202202220102020220200210011101112002020112001212122202210122122122222020222202121100022110111210220012101221112211022222201202110220022101222221220122222202021012201222200020221122222020120122110200200211210122222002112210200201002022002001202221220222221121221101121012121202112112122101202222200112221202022102110121101002121100102001022211102211000200222000120002212211201222112122102101222221202122200122110021221222121222211211022211202222210022212222021202122120100120120221222012022112220202000220212220022112102222201202101010202100221221201012022222001012022212022222211210222200202020200222210222020002220221102001011102102000220002010221110210212212021122002000211220200010022002221111211122011121012210222222212202221202222212202220202112220202121222211001000020002000022111220221112201210222210221222202102012220122121221212000000211222202020222210222220202120202011200122012212122222002210212121202101021010211110101022012020200202222220211202102222012012011201201111000212110212202220202122021210222121222021222111000202100212122202202220202022012021222120002111002212221020011121201012220222122021122112111201202212012212012201112200002210020210200021222210222201202112202212021201112202222120022121102111220122122002202121021001212210221221222220212102012211010001201212222000012212212022021101100222002001202100021212112202022210102222222221122100211102020110211022120022211120201210222212011022202102221210201002012212001202000212112220122020221221122200211200211222121212120200202222202221112110012221001110211022210122120011212201210212201222102212002220001210211012110102211200212022221020000221112211202002200122201212120220202201222220212000112120202000012002012222121122211011210210121120222212220201100022212202202220122212002012220012100122002000201102022112211212022221002212222022212010110110121211211112212120012011220200212200121022002022002200112102121202210121211200202221122101221221102101211101122112222202221022212221212120112020222010021200101022221122002210221010221222112122122122111212001202212012211010112210212200220122201020022201202112021222000202112222222220202120222210220211101010222122212022200021210212200212020022222222000222120100121202202222211222012102122110101020222222212222111202002222021110112200202221212212210221222010210002102021002220200120212211022022112012100212100212100002101020110222022011021221121221022221200020000202102202002222202200202021002110220111121122221222221021010222212111200201222122102102220222022220012112021112100202212011121122121221222022211112020202000222020012102200222021202010201022211021010102220120220011211001201220011122202202120211012112112212102122121201112100121022021120212010202021111202102212200201012212212220222010211011002211012002221222122122201122202221100010020000022001121002012000010220222001110202102021222011000101100220202220020021200211100112021000210012121222021020201000121202000000100221100010212")}

	layers := img.GetLayers()
	minZeroes := math.MaxInt32
	minZeroesIndex := 0
	for i, layer := range layers {
		zeroes := countRunes(layer, '0')
		if zeroes < minZeroes {
			minZeroes = zeroes
			minZeroesIndex = i
		}
	}

	ones := countRunes(layers[minZeroesIndex], '1')
	twos := countRunes(layers[minZeroesIndex], '2')

	fmt.Printf("One count times two count: %d", ones*twos)

	img.Show()
}

func countRunes(layer []rune, target rune) int {
	zeroes := 0
	for _, r := range layer {
		if r == target {
			zeroes++
		}
	}
	return zeroes
}
func day7() {
	program := []int{3, 8, 1001, 8, 10, 8, 105, 1, 0, 0, 21, 38, 63, 88, 97, 118, 199, 280, 361, 442, 99999, 3, 9, 1002, 9, 3, 9, 101, 2, 9, 9, 1002, 9, 4, 9, 4, 9, 99, 3, 9, 101, 3, 9, 9, 102, 5, 9, 9, 101, 3, 9, 9, 1002, 9, 3, 9, 101, 3, 9, 9, 4, 9, 99, 3, 9, 1002, 9, 2, 9, 1001, 9, 3, 9, 102, 3, 9, 9, 101, 2, 9, 9, 1002, 9, 4, 9, 4, 9, 99, 3, 9, 102, 2, 9, 9, 4, 9, 99, 3, 9, 102, 4, 9, 9, 101, 5, 9, 9, 102, 2, 9, 9, 101, 5, 9, 9, 4, 9, 99, 3, 9, 1002, 9, 2, 9, 4, 9, 3, 9, 101, 1, 9, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 101, 1, 9, 9, 4, 9, 3, 9, 101, 2, 9, 9, 4, 9, 3, 9, 1001, 9, 2, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 101, 1, 9, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 99, 3, 9, 101, 1, 9, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 1001, 9, 2, 9, 4, 9, 3, 9, 1001, 9, 2, 9, 4, 9, 3, 9, 1001, 9, 1, 9, 4, 9, 3, 9, 1001, 9, 1, 9, 4, 9, 3, 9, 1001, 9, 2, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 1002, 9, 2, 9, 4, 9, 3, 9, 1001, 9, 1, 9, 4, 9, 99, 3, 9, 1002, 9, 2, 9, 4, 9, 3, 9, 1002, 9, 2, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 1002, 9, 2, 9, 4, 9, 3, 9, 1001, 9, 1, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 101, 1, 9, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 99, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 101, 1, 9, 9, 4, 9, 3, 9, 1002, 9, 2, 9, 4, 9, 3, 9, 1002, 9, 2, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 1002, 9, 2, 9, 4, 9, 3, 9, 1001, 9, 2, 9, 4, 9, 3, 9, 101, 2, 9, 9, 4, 9, 3, 9, 1001, 9, 2, 9, 4, 9, 3, 9, 101, 1, 9, 9, 4, 9, 99, 3, 9, 101, 1, 9, 9, 4, 9, 3, 9, 101, 1, 9, 9, 4, 9, 3, 9, 101, 1, 9, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 1001, 9, 1, 9, 4, 9, 3, 9, 1001, 9, 2, 9, 4, 9, 3, 9, 101, 2, 9, 9, 4, 9, 3, 9, 102, 2, 9, 9, 4, 9, 3, 9, 1001, 9, 1, 9, 4, 9, 3, 9, 1001, 9, 2, 9, 4, 9, 99}
	values := []int{5, 6, 7, 8, 9}
	maxValue := 0
	heapPermutation(program, values, 5, &maxValue, true)
}

func heapPermutation(program []int, values []int, size int, maxValue *int, feedback bool) {
	if size == 1 {
		value := doTheThing(program, values, feedback)
		if value > *maxValue {
			fmt.Printf("%v outputs %d\n", values, value)
			*maxValue = value
		}
	} else {
		for i := 0; i < size; i++ {
			heapPermutation(program, values, size-1, maxValue, feedback)

			if size%2 == 1 {
				temp := values[0]
				values[0] = values[size-1]
				values[size-1] = temp
			} else {
				temp := values[i]
				values[i] = values[size-1]
				values[size-1] = temp
			}
		}
	}
}

func doTheThing(program []int, inputs []int, feedback bool) int {
	programs := make([]intcode.Program, 5)

	for i := 0; i < 5; i++ {
		code := make([]int, len(program))
		copy(code, program[:])
		var input chan int
		if i == 0 {
			input = make(chan int, 2)
		} else {
			input = programs[i-1].Output
		}
		output := make(chan int, 2)
		programs[i] = intcode.Program{Code: code, Input: input, Output: output, Name: strconv.Itoa(i)}
	}

	//pass in the initial values
	for i := range programs {
		programs[i].Input <- inputs[i]
	}

	if feedback {
		programs[4].Output = programs[0].Input
		programs[4].Halted = make(chan int)
	}

	for _, p := range programs {
		go p.Run()
	}

	programs[0].Input <- 0
	if !feedback {
		result := <-programs[4].Output
		return result
	}
	//fmt.Println("Waiting for 4 to halt")
	<-programs[4].Halted
	//fmt.Println("It has halted")
	result := <-programs[4].Output
	return result

}
